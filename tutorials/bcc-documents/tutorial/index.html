
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Build, Distribute and Run CO-RE eBPF programs easier with JSON and Webassembly OCI images">
      
      
      
        <link rel="canonical" href="https://eunomia.dev/tutorials/bcc-documents/tutorial/">
      
      
      
      <link rel="icon" href="../../../assets/icon.svg">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.1.21">
    
    
      
        <title>bcc Tutorial - eunomia-bpf</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.eebd395e.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#bcc-tutorial" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="eunomia-bpf" class="md-header__button md-logo" aria-label="eunomia-bpf" data-md-component="logo">
      
  <img src="../../../assets/icon.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            eunomia-bpf
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              bcc Tutorial
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
      <div class="md-header__option">
        <div class="md-select">
          
          <button class="md-header__button md-icon" aria-label="Select language">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
          </button>
          <div class="md-select__inner">
            <ul class="md-select__list">
              
                <li class="md-select__item">
                  <a href="./" hreflang="en" class="md-select__link">
                    English
                  </a>
                </li>
              
                <li class="md-select__item">
                  <a href="../../../zh/tutorials/bcc-documents/tutorial/" hreflang="zh" class="md-select__link">
                    简体中文
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/eunomia-bpf" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    eunomia-bpf
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        Home
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../miscellaneous/quickstart/" class="md-tabs__link">
        Documents
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link">
        Tutorials
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../blogs/" class="md-tabs__link">
        Blogs
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="eunomia-bpf" class="md-nav__button md-logo" aria-label="eunomia-bpf" data-md-component="logo">
      
  <img src="../../../assets/icon.svg" alt="logo">

    </a>
    eunomia-bpf
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/eunomia-bpf" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    eunomia-bpf
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../..">Home</a>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
      
      
        
          
        
          
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../architecture/">Documents</a>
          
            <label for="__nav_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Documents
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../miscellaneous/quickstart/" class="md-nav__link">
        Quick Start
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../support/" class="md-nav__link">
        Support
      </a>
    </li>
  

            
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../miscellaneous/introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../setup/doc/" class="md-nav__link">
        README
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_6" >
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../setup/">Installation</a>
          
            <label for="__nav_2_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_6">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../setup/build/" class="md-nav__link">
        From source
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../setup/build-android-arm/" class="md-nav__link">
        Android
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_7" >
      
      
        
          
            
          
        
          
        
          
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../ecc/">eunomia-cc</a>
          
            <label for="__nav_2_7">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_7">
          <span class="md-nav__icon md-icon"></span>
          eunomia-cc
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ecc/config-lua-depreciate.zh/" class="md-nav__link">
        lua config [deprecated]
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ecc/usage/" class="md-nav__link">
        usage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ecc/" class="md-nav__link">
        eunomia-cc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ecc/docker-usage/" class="md-nav__link">
        use with docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ecc/github-template/" class="md-nav__link">
        github template
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_8" >
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../ecli/">ecli</a>
          
            <label for="__nav_2_8">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_8">
          <span class="md-nav__icon md-icon"></span>
          ecli
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ecli/server/" class="md-nav__link">
        ecli server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ecli/ecli-dockerfile-usage.md" class="md-nav__link">
        ecli with docker
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_9" >
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../exporter/">exporter</a>
          
            <label for="__nav_2_9">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_9">
          <span class="md-nav__icon md-icon"></span>
          exporter
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exporter/usage/" class="md-nav__link">
        usage
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_10" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_10" id="__nav_2_10_label" tabindex="0">
          Misc
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_10">
          <span class="md-nav__icon md-icon"></span>
          Misc
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../miscellaneous/benchmark/" class="md-nav__link">
        benchmark
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../miscellaneous/SUMMARY/" class="md-nav__link">
        SUMMARY
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../miscellaneous/manual.zh/" class="md-nav__link">
        manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../miscellaneous/introduction/" class="md-nav__link">
        introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../miscellaneous/video/" class="md-nav__link">
        video
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../miscellaneous/common_problems/" class="md-nav__link">
        common problems
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../miscellaneous/online.zh/" class="md-nav__link">
        Online Demo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../miscellaneous/supporting-external-BTF.zh/" class="md-nav__link">
        supporting-external-BTF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../miscellaneous/quickstart/" class="md-nav__link">
        quickstart
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
      
      
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../">Tutorials</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../0-introduce/" class="md-nav__link">
        eBPF Beginner's Development Tutorial 0: Introduction to the Basic Concepts of eBPF and Common Development Tools
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1-helloworld/" class="md-nav__link">
        eBPF Getting Started Tutorial 1 Hello World, Basic Framework and Development Process
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2-kprobe-unlink/" class="md-nav__link">
        eBPF Beginner's Development Practice Tutorial 2: Using kprobe to Monitor the unlink System Call in eBPF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../3-fentry-unlink/" class="md-nav__link">
        eBPF Introductory Development Practice Tutorial 3: Detecting Captured Unlink System Calls in eBPF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../4-opensnoop/" class="md-nav__link">
        eBPF Getting Started Development Tutorial 4: Capturing the System Call Collection of Process Opening Files in eBPF and Using Global Variables to Filter Process PIDs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../5-uprobe-bashreadline/" class="md-nav__link">
        eBPF Beginner's Development Tutorial 5: Capturing readline Function Calls in eBPF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../6-sigsnoop/" class="md-nav__link">
        eBPF Beginner's Development Practice Tutorial 6: Capturing a Collection of System Calls that Send Signals to Processes, Using a Hash Map to Store State
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../7-execsnoop/" class="md-nav__link">
        eBPF Beginner's Practical Tutorial Seven: Capturing Process Execution/Exit Time, Printing Output to User Space via perf event array
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../8-exitsnoop/" class="md-nav__link">
        eBPF Introductory Development Tutorial 8: Monitoring Process Exit Events with eBPF, Using Ring Buffer to Print Output to User Space
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../9-runqlat/" class="md-nav__link">
        eBPF Beginner's Development Tutorial 9: Capturing Process Scheduling Latency and Recording as Histogram
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../10-hardirqs/" class="md-nav__link">
        eBPF Beginner's Development Tutorial Ten: Capturing Interrupt Events in eBPF Using hardirqs or softirqs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../11-bootstrap/" class="md-nav__link">
        eBPF Beginner's Development Practice Tutorial 11: Using libbpf to Develop User-Space Programs in eBPF and Trace exec() and exit() System Calls
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../12-profile/" class="md-nav__link">
        eBPF Beginner's Practical Tutorial 12: Using eBPF Program Profile for Performance Analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../13-tcpconnlat/" class="md-nav__link">
        eBPF Beginner's Development Practice Tutorial 13: Statistics of TCP Connection Delay and Data Processing in User Space Using libbpf
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../14-tcpstates/" class="md-nav__link">
        eBPF Introductory Practice Tutorial 14: Recording TCP Connection Status and TCP RTT
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../15-javagc/" class="md-nav__link">
        eBPF Introduction Tutorial 15: Capturing User-Space Java GC Event Duration Using USDT
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../16-memleak/" class="md-nav__link">
        eBPF Getting Started Tutorial 16: Writing eBPF Program Memleak for Monitoring Memory Leaks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../17-biopattern/" class="md-nav__link">
        eBPF Getting Started Tutorial: Writing eBPF Program Biopattern: Statistical Random/Sequential Disk I/O
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../18-further-reading/" class="md-nav__link">
        More Reference Materials
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../19-lsm-connect/" class="md-nav__link">
        eBPF Getting Started Tutorial: Security Detection and Defense using LSM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../20-tc/" class="md-nav__link">
        eBPF Introductory Practice Tutorial 20: Use eBPF for tc Traffic Control
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../21-xdp/" class="md-nav__link">
        eBPF Beginner Tutorial 21: Programmable Packet Processing with XDP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../22-android/" class="md-nav__link">
        Using eBPF Programs on Android
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../23-http/" class="md-nav__link">
        http
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../24-hide/" class="md-nav__link">
        TODO: translate into English
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../25-signal/" class="md-nav__link">
        Terminate Malicious Processes Using bpf_send_signal
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../26-sudo/" class="md-nav__link">
        Using eBPF to add sudo user
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../27-replace/" class="md-nav__link">
        Replace Text Read or Written by Any Program with eBPF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../28-detach/" class="md-nav__link">
        Running eBPF Programs After User-Space Application Exits: The Lifecycle of eBPF Programs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../29-sockops/" class="md-nav__link">
        eBPF sockops Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../30-openssl/" class="md-nav__link">
        eBPF openssl
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../31-goroutine/" class="md-nav__link">
        goroutine trace
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../32-funclatency/" class="md-nav__link">
        func latency
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../README.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../blogs/">Blogs</a>
          
            <label for="__nav_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Blogs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blogs/coolbpf-eunomia.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blogs/README.md" class="md-nav__link">
        README
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blogs/bpf-news.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blogs/lmp-eunomia.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blogs/wasm-bpf/" class="md-nav__link">
        Wasm-bpf: A Common eBPF Kernel Programmability for Cloud-Native Webassembly
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blogs/how-to-write-c-in-wasm.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blogs/introduce-to-wasm-bpf-wasm.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blogs/introduce-to-wasm-bpf-bpf-community.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blogs/0_3_0-release.md" class="md-nav__link">
        0.3.0-RELEASE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blogs/ebpf-wasm.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blogs/GPTtrace.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blogs/how-to-write-rust-in-wasm.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blogs/eunomia-bpf的三月进展.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blogs/test-for-Android.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#observability" class="md-nav__link">
    Observability
  </a>
  
    <nav class="md-nav" aria-label="Observability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#0-before-bcc" class="md-nav__link">
    0. Before bcc
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-general-performance" class="md-nav__link">
    1. General Performance
  </a>
  
    <nav class="md-nav" aria-label="1. General Performance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-execsnoop" class="md-nav__link">
    1.1 execsnoop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-opensnoop" class="md-nav__link">
    1.2. opensnoop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-ext4slower-or-btrfs-xfs-zfs" class="md-nav__link">
    1.3. ext4slower (or btrfs42, xfs42, zfs42)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-biolatency" class="md-nav__link">
    1.4. biolatency
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-biosnoop" class="md-nav__link">
    1.5. biosnoop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16-cachestat" class="md-nav__link">
    1.6. cachestat
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#17-tcpconnect" class="md-nav__link">
    1.7. tcpconnect
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#18-tcpaccept" class="md-nav__link">
    1.8. tcpaccept
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#19-tcpretrans" class="md-nav__link">
    1.9. tcpretrans
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#110-runqlat" class="md-nav__link">
    1.10. runqlat
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#111-profile" class="md-nav__link">
    1.11. profile
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-observability-with-generic-tools" class="md-nav__link">
    2. Observability with Generic Tools
  </a>
  
    <nav class="md-nav" aria-label="2. Observability with Generic Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-trace" class="md-nav__link">
    2.1. trace
  </a>
  
    <nav class="md-nav" aria-label="2.1. trace">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1" class="md-nav__link">
    Example 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2" class="md-nav__link">
    Example 2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-3" class="md-nav__link">
    Example 3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-argdist" class="md-nav__link">
    2.2. argdist
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-funccount" class="md-nav__link">
    2.3. funccount
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#networking" class="md-nav__link">
    Networking
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="bcc-tutorial">bcc Tutorial</h1>
<p>This tutorial covers how to use <a href="https://github.com/iovisor/bcc">bcc</a> tools to quickly solve performance, troubleshooting, and networking issues. If you want to develop new bcc tools, see <a href="../tutorial_bcc_python_developer/">tutorial_bcc_python_developer.md</a> for that tutorial.</p>
<p>It is assumed for this tutorial that bcc is already installed, and you can run tools like execsnoop successfully. See <a href="https://github.com/iovisor/bcc/tree/master/INSTALL.md">INSTALL.md</a>. This uses enhancements added to the Linux 4.x series.</p>
<h2 id="observability">Observability</h2>
<p>Some quick wins.</p>
<h3 id="0-before-bcc">0. Before bcc</h3>
<p>Before using bcc, you should start with the Linux basics. One reference is the <a href="https://netflixtechblog.com/linux-performance-analysis-in-60-000-milliseconds-accc10403c55">Linux Performance Analysis in 60,000 Milliseconds</a> post, which covers these commands:</p>
<ol>
<li>uptime</li>
<li>dmesg | tail</li>
<li>vmstat 1</li>
<li>mpstat -P ALL 1</li>
<li>pidstat 1</li>
<li>iostat -xz 1</li>
<li>free -m</li>
<li>sar -n DEV 1</li>
<li>sar -n TCP,ETCP 1</li>
<li>top</li>
</ol>
<h3 id="1-general-performance">1. General Performance</h3>
<p>Here is a generic checklist for performance investigations with bcc, first as a list, then in detail:</p>
<ol>
<li>execsnoop</li>
<li>opensnoop</li>
<li>ext4slower (or btrfs*, xfs*, zfs*)</li>
<li>biolatency</li>
<li>biosnoop</li>
<li>cachestat</li>
<li>tcpconnect</li>
<li>tcpaccept</li>
<li>tcpretrans</li>
<li>runqlat</li>
<li>profile</li>
</ol>
<p>These tools may be installed on your system under /usr/share/bcc/tools, or you can run them from the bcc github repo under /tools where they have a .py extension. Browse the 50+ tools available for more analysis options.</p>
<h4 id="11-execsnoop">1.1 execsnoop</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># ./execsnoop</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>PCOMM<span class="w">            </span>PID<span class="w">    </span>RET<span class="w"> </span>ARGS
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>supervise<span class="w">        </span><span class="m">9660</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>./run
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>supervise<span class="w">        </span><span class="m">9661</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>./run
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>mkdir<span class="w">            </span><span class="m">9662</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>/bin/mkdir<span class="w"> </span>-p<span class="w"> </span>./main
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>run<span class="w">              </span><span class="m">9663</span><span class="w">     </span><span class="m">0</span><span class="w"> </span>./run
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="o">[</span>...<span class="o">]</span>
</code></pre></div>
<p>execsnoop prints one line of output for each new process. Check for short-lived processes. These can consume CPU resources, but not show up in most monitoring tools that periodically take snapshots of which processes are running.</p>
<p>It works by tracing exec(), not the fork(), so it will catch many types of new processes but not all (eg, it won't see an application launching working processes, that doesn't exec() anything else).</p>
<p>More <a href="https://github.com/iovisor/bcc/tree/master/tools/execsnoop_example.txt">examples</a>.</p>
<h4 id="12-opensnoop">1.2. opensnoop</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># ./opensnoop</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>PID<span class="w">    </span>COMM<span class="w">               </span>FD<span class="w"> </span>ERR<span class="w"> </span>PATH
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="m">1565</span><span class="w">   </span>redis-server<span class="w">        </span><span class="m">5</span><span class="w">   </span><span class="m">0</span><span class="w"> </span>/proc/1565/stat
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="m">1565</span><span class="w">   </span>redis-server<span class="w">        </span><span class="m">5</span><span class="w">   </span><span class="m">0</span><span class="w"> </span>/proc/1565/stat
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="m">1565</span><span class="w">   </span>redis-server<span class="w">        </span><span class="m">5</span><span class="w">   </span><span class="m">0</span><span class="w"> </span>/proc/1565/stat
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="m">1603</span><span class="w">   </span>snmpd<span class="w">               </span><span class="m">9</span><span class="w">   </span><span class="m">0</span><span class="w"> </span>/proc/net/dev
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="m">1603</span><span class="w">   </span>snmpd<span class="w">              </span><span class="m">11</span><span class="w">   </span><span class="m">0</span><span class="w"> </span>/proc/net/if_inet6
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="m">1603</span><span class="w">   </span>snmpd<span class="w">              </span>-1<span class="w">   </span><span class="m">2</span><span class="w"> </span>/sys/class/net/eth0/device/vendor
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="m">1603</span><span class="w">   </span>snmpd<span class="w">              </span><span class="m">11</span><span class="w">   </span><span class="m">0</span><span class="w"> </span>/proc/sys/net/ipv4/neigh/eth0/retrans_time_ms
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="m">1603</span><span class="w">   </span>snmpd<span class="w">              </span><span class="m">11</span><span class="w">   </span><span class="m">0</span><span class="w"> </span>/proc/sys/net/ipv6/neigh/eth0/retrans_time_ms
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="m">1603</span><span class="w">   </span>snmpd<span class="w">              </span><span class="m">11</span><span class="w">   </span><span class="m">0</span><span class="w"> </span>/proc/sys/net/ipv6/conf/eth0/forwarding
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="o">[</span>...<span class="o">]</span>
</code></pre></div>
<p>opensnoop prints one line of output for each open() syscall, including details.</p>
<p>Files that are opened can tell you a lot about how applications work: identifying their data files, config files, and log files. Sometimes applications can misbehave, and perform poorly, when they are constantly attempting to read files that do not exist. opensnoop gives you a quick look.</p>
<p>More <a href="https://github.com/iovisor/bcc/tree/master/tools/opensnoop_example.txt">examples</a>.</p>
<h4 id="13-ext4slower-or-btrfs-xfs-zfs">1.3. ext4slower (or btrfs*, xfs*, zfs*)</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># ./ext4slower</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>Tracing<span class="w"> </span>ext4<span class="w"> </span>operations<span class="w"> </span>slower<span class="w"> </span>than<span class="w"> </span><span class="m">10</span><span class="w"> </span>ms
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>TIME<span class="w">     </span>COMM<span class="w">           </span>PID<span class="w">    </span>T<span class="w"> </span>BYTES<span class="w">   </span>OFF_KB<span class="w">   </span>LAT<span class="o">(</span>ms<span class="o">)</span><span class="w"> </span>FILENAME
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="m">06</span>:35:01<span class="w"> </span>cron<span class="w">           </span><span class="m">16464</span><span class="w">  </span>R<span class="w"> </span><span class="m">1249</span><span class="w">    </span><span class="m">0</span><span class="w">          </span><span class="m">16</span>.05<span class="w"> </span>common-auth
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="m">06</span>:35:01<span class="w"> </span>cron<span class="w">           </span><span class="m">16463</span><span class="w">  </span>R<span class="w"> </span><span class="m">1249</span><span class="w">    </span><span class="m">0</span><span class="w">          </span><span class="m">16</span>.04<span class="w"> </span>common-auth
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="m">06</span>:35:01<span class="w"> </span>cron<span class="w">           </span><span class="m">16465</span><span class="w">  </span>R<span class="w"> </span><span class="m">1249</span><span class="w">    </span><span class="m">0</span><span class="w">          </span><span class="m">16</span>.03<span class="w"> </span>common-auth
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="m">06</span>:35:01<span class="w"> </span>cron<span class="w">           </span><span class="m">16465</span><span class="w">  </span>R<span class="w"> </span><span class="m">4096</span><span class="w">    </span><span class="m">0</span><span class="w">          </span><span class="m">10</span>.62<span class="w"> </span>login.defs
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="m">06</span>:35:01<span class="w"> </span>cron<span class="w">           </span><span class="m">16464</span><span class="w">  </span>R<span class="w"> </span><span class="m">4096</span><span class="w">    </span><span class="m">0</span><span class="w">          </span><span class="m">10</span>.61<span class="w"> </span>login.defs
</code></pre></div>
<p>ext4slower traces the ext4 file system and times common operations, and then only prints those that exceed a threshold.</p>
<p>This is great for identifying or exonerating one type of performance issue: show individually slow disk i/O via the file system. Disks process I/O asynchronously, and it can be difficult to associate latency at that layer with the latency applications experience. Tracing higher up in the kernel stack, at the VFS -&gt; file system interface, will more closely match what an application suffers. Use this tool to identify if file system latency exceeds a given threshold.</p>
<p>Similar tools exist in bcc for other file systems: btrfsslower, xfsslower, and zfsslower. There is also fileslower, which works at the VFS layer and traces everything (although at some higher overhead).</p>
<p>More <a href="https://github.com/iovisor/bcc/tree/master/tools/ext4slower_example.txt">examples</a>.</p>
<h4 id="14-biolatency">1.4. biolatency</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># ./biolatency</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>Tracing<span class="w"> </span>block<span class="w"> </span>device<span class="w"> </span>I/O...<span class="w"> </span>Hit<span class="w"> </span>Ctrl-C<span class="w"> </span>to<span class="w"> </span>end.
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>^C
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">     </span>usecs<span class="w">           </span>:<span class="w"> </span>count<span class="w">     </span>distribution
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">       </span><span class="m">0</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">1</span><span class="w">        </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                      </span><span class="p">|</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">       </span><span class="m">2</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">3</span><span class="w">        </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                      </span><span class="p">|</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">       </span><span class="m">4</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">7</span><span class="w">        </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                      </span><span class="p">|</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">       </span><span class="m">8</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">15</span><span class="w">       </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                      </span><span class="p">|</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">      </span><span class="m">16</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">31</span><span class="w">       </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                      </span><span class="p">|</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">      </span><span class="m">32</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">63</span><span class="w">       </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                      </span><span class="p">|</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">      </span><span class="m">64</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">127</span><span class="w">      </span>:<span class="w"> </span><span class="m">1</span><span class="w">        </span><span class="p">|</span><span class="w">                                      </span><span class="p">|</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">     </span><span class="m">128</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">255</span><span class="w">      </span>:<span class="w"> </span><span class="m">12</span><span class="w">       </span><span class="p">|</span>********<span class="w">                              </span><span class="p">|</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">     </span><span class="m">256</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">511</span><span class="w">      </span>:<span class="w"> </span><span class="m">15</span><span class="w">       </span><span class="p">|</span>**********<span class="w">                            </span><span class="p">|</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">     </span><span class="m">512</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">1023</span><span class="w">     </span>:<span class="w"> </span><span class="m">43</span><span class="w">       </span><span class="p">|</span>*******************************<span class="w">       </span><span class="p">|</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">    </span><span class="m">1024</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">2047</span><span class="w">     </span>:<span class="w"> </span><span class="m">52</span><span class="w">       </span><span class="p">|</span>**************************************<span class="p">|</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="w">    </span><span class="m">2048</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">4095</span><span class="w">     </span>:<span class="w"> </span><span class="m">47</span><span class="w">       </span><span class="p">|</span>**********************************<span class="w">    </span><span class="p">|</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="w">    </span><span class="m">4096</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">8191</span><span class="w">     </span>:<span class="w"> </span><span class="m">52</span><span class="w">       </span><span class="p">|</span>**************************************<span class="p">|</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="w">    </span><span class="m">8192</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">16383</span><span class="w">    </span>:<span class="w"> </span><span class="m">36</span><span class="w">       </span><span class="p">|</span>**************************<span class="w">            </span><span class="p">|</span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="w">   </span><span class="m">16384</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">32767</span><span class="w">    </span>:<span class="w"> </span><span class="m">15</span><span class="w">       </span><span class="p">|</span>**********<span class="w">                            </span><span class="p">|</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="w">   </span><span class="m">32768</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">65535</span><span class="w">    </span>:<span class="w"> </span><span class="m">2</span><span class="w">        </span><span class="p">|</span>*<span class="w">                                     </span><span class="p">|</span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="w">   </span><span class="m">65536</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">131071</span><span class="w">   </span>:<span class="w"> </span><span class="m">2</span><span class="w">        </span><span class="p">|</span>*<span class="w">                                     </span><span class="p">|</span>
</code></pre></div>
<p>biolatency traces disk I/O latency (time from device issue to completion), and when the tool ends (Ctrl-C, or a given interval), it prints a histogram summary of the latency.</p>
<p>This is great for understanding disk I/O latency beyond the average times given by tools like iostat. I/O latency outliers will be visible at the end of the distribution, as well as multi-mode distributions.</p>
<p>More <a href="https://github.com/iovisor/bcc/tree/master/tools/biolatency_example.txt">examples</a>.</p>
<h4 id="15-biosnoop">1.5. biosnoop</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># ./biosnoop</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>TIME<span class="o">(</span>s<span class="o">)</span><span class="w">        </span>COMM<span class="w">           </span>PID<span class="w">    </span>DISK<span class="w">    </span>T<span class="w">  </span>SECTOR<span class="w">    </span>BYTES<span class="w">   </span>LAT<span class="o">(</span>ms<span class="o">)</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="m">0</span>.000004001<span class="w">    </span>supervise<span class="w">      </span><span class="m">1950</span><span class="w">   </span>xvda1<span class="w">   </span>W<span class="w">  </span><span class="m">13092560</span><span class="w">  </span><span class="m">4096</span><span class="w">       </span><span class="m">0</span>.74
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="m">0</span>.000178002<span class="w">    </span>supervise<span class="w">      </span><span class="m">1950</span><span class="w">   </span>xvda1<span class="w">   </span>W<span class="w">  </span><span class="m">13092432</span><span class="w">  </span><span class="m">4096</span><span class="w">       </span><span class="m">0</span>.61
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="m">0</span>.001469001<span class="w">    </span>supervise<span class="w">      </span><span class="m">1956</span><span class="w">   </span>xvda1<span class="w">   </span>W<span class="w">  </span><span class="m">13092440</span><span class="w">  </span><span class="m">4096</span><span class="w">       </span><span class="m">1</span>.24
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="m">0</span>.001588002<span class="w">    </span>supervise<span class="w">      </span><span class="m">1956</span><span class="w">   </span>xvda1<span class="w">   </span>W<span class="w">  </span><span class="m">13115128</span><span class="w">  </span><span class="m">4096</span><span class="w">       </span><span class="m">1</span>.09
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="m">1</span>.022346001<span class="w">    </span>supervise<span class="w">      </span><span class="m">1950</span><span class="w">   </span>xvda1<span class="w">   </span>W<span class="w">  </span><span class="m">13115272</span><span class="w">  </span><span class="m">4096</span><span class="w">       </span><span class="m">0</span>.98
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="m">1</span>.022568002<span class="w">    </span>supervise<span class="w">      </span><span class="m">1950</span><span class="w">   </span>xvda1<span class="w">   </span>W<span class="w">  </span><span class="m">13188496</span><span class="w">  </span><span class="m">4096</span><span class="w">       </span><span class="m">0</span>.93
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="o">[</span>...<span class="o">]</span>
</code></pre></div>
<p>biosnoop prints a line of output for each disk I/O, with details including latency (time from device issue to completion).</p>
<p>This allows you to examine disk I/O in more detail, and look for time-ordered patterns (eg, reads queueing behind writes). Note that the output will be verbose if your system performs disk I/O at a high rate.</p>
<p>More <a href="https://github.com/iovisor/bcc/tree/master/tools/biosnoop_example.txt">examples</a>.</p>
<h4 id="16-cachestat">1.6. cachestat</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1"># ./cachestat</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span>HITS<span class="w">   </span>MISSES<span class="w">  </span>DIRTIES<span class="w">  </span>READ_HIT%<span class="w"> </span>WRITE_HIT%<span class="w">   </span>BUFFERS_MB<span class="w">  </span>CACHED_MB
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span><span class="m">1074</span><span class="w">       </span><span class="m">44</span><span class="w">       </span><span class="m">13</span><span class="w">      </span><span class="m">94</span>.9%<span class="w">       </span><span class="m">2</span>.9%<span class="w">            </span><span class="m">1</span><span class="w">        </span><span class="m">223</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="m">2195</span><span class="w">      </span><span class="m">170</span><span class="w">        </span><span class="m">8</span><span class="w">      </span><span class="m">92</span>.5%<span class="w">       </span><span class="m">6</span>.8%<span class="w">            </span><span class="m">1</span><span class="w">        </span><span class="m">143</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">     </span><span class="m">182</span><span class="w">       </span><span class="m">53</span><span class="w">       </span><span class="m">56</span><span class="w">      </span><span class="m">53</span>.6%<span class="w">       </span><span class="m">1</span>.3%<span class="w">            </span><span class="m">1</span><span class="w">        </span><span class="m">143</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">   </span><span class="m">62480</span><span class="w">    </span><span class="m">40960</span><span class="w">    </span><span class="m">20480</span><span class="w">      </span><span class="m">40</span>.6%<span class="w">      </span><span class="m">19</span>.8%<span class="w">            </span><span class="m">1</span><span class="w">        </span><span class="m">223</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">       </span><span class="m">7</span><span class="w">        </span><span class="m">2</span><span class="w">        </span><span class="m">5</span><span class="w">      </span><span class="m">22</span>.2%<span class="w">      </span><span class="m">22</span>.2%<span class="w">            </span><span class="m">1</span><span class="w">        </span><span class="m">223</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">     </span><span class="m">348</span><span class="w">        </span><span class="m">0</span><span class="w">        </span><span class="m">0</span><span class="w">     </span><span class="m">100</span>.0%<span class="w">       </span><span class="m">0</span>.0%<span class="w">            </span><span class="m">1</span><span class="w">        </span><span class="m">223</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="o">[</span>...<span class="o">]</span>
</code></pre></div>
<p>cachestat prints a one line summary every second (or every custom interval) showing statistics from the file system cache.</p>
<p>Use this to identify a low cache hit ratio, and a high rate of misses: which gives one lead for performance tuning.</p>
<p>More <a href="https://github.com/iovisor/bcc/tree/master/tools/cachestat_example.txt">examples</a>.</p>
<h4 id="17-tcpconnect">1.7. tcpconnect</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># ./tcpconnect</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>PID<span class="w">    </span>COMM<span class="w">         </span>IP<span class="w"> </span>SADDR<span class="w">            </span>DADDR<span class="w">            </span>DPORT
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="m">1479</span><span class="w">   </span>telnet<span class="w">       </span><span class="m">4</span><span class="w">  </span><span class="m">127</span>.0.0.1<span class="w">        </span><span class="m">127</span>.0.0.1<span class="w">        </span><span class="m">23</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="m">1469</span><span class="w">   </span>curl<span class="w">         </span><span class="m">4</span><span class="w">  </span><span class="m">10</span>.201.219.236<span class="w">   </span><span class="m">54</span>.245.105.25<span class="w">    </span><span class="m">80</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="m">1469</span><span class="w">   </span>curl<span class="w">         </span><span class="m">4</span><span class="w">  </span><span class="m">10</span>.201.219.236<span class="w">   </span><span class="m">54</span>.67.101.145<span class="w">    </span><span class="m">80</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="m">1991</span><span class="w">   </span>telnet<span class="w">       </span><span class="m">6</span><span class="w">  </span>::1<span class="w">              </span>::1<span class="w">              </span><span class="m">23</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="m">2015</span><span class="w">   </span>ssh<span class="w">          </span><span class="m">6</span><span class="w">  </span>fe80::2000:bff:fe82:3ac<span class="w"> </span>fe80::2000:bff:fe82:3ac<span class="w"> </span><span class="m">22</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="o">[</span>...<span class="o">]</span>
</code></pre></div>
<p>tcpconnect prints one line of output for every active TCP connection (eg, via connect()), with details including source and destination addresses.</p>
<p>Look for unexpected connections that may point to inefficiencies in application configuration, or an intruder.</p>
<p>More <a href="https://github.com/iovisor/bcc/tree/master/tools/tcpconnect_example.txt">examples</a>.</p>
<h4 id="18-tcpaccept">1.8. tcpaccept</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># ./tcpaccept</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>PID<span class="w">    </span>COMM<span class="w">         </span>IP<span class="w"> </span>RADDR<span class="w">            </span>LADDR<span class="w">            </span>LPORT
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="m">907</span><span class="w">    </span>sshd<span class="w">         </span><span class="m">4</span><span class="w">  </span><span class="m">192</span>.168.56.1<span class="w">     </span><span class="m">192</span>.168.56.102<span class="w">   </span><span class="m">22</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="m">907</span><span class="w">    </span>sshd<span class="w">         </span><span class="m">4</span><span class="w">  </span><span class="m">127</span>.0.0.1<span class="w">        </span><span class="m">127</span>.0.0.1<span class="w">        </span><span class="m">22</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="m">5389</span><span class="w">   </span>perl<span class="w">         </span><span class="m">6</span><span class="w">  </span><span class="m">1234</span>:ab12:2040:5020:2299:0:5:0<span class="w"> </span><span class="m">1234</span>:ab12:2040:5020:2299:0:5:0<span class="w"> </span><span class="m">7001</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="o">[</span>...<span class="o">]</span>
</code></pre></div>
<p>tcpaccept prints one line of output for every passive TCP connection (eg, via accept()), with details including source and destination addresses.</p>
<p>Look for unexpected connections that may point to inefficiencies in application configuration, or an intruder.</p>
<p>More <a href="https://github.com/iovisor/bcc/tree/master/tools/tcpaccept_example.txt">examples</a>.</p>
<h4 id="19-tcpretrans">1.9. tcpretrans</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># ./tcpretrans</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>TIME<span class="w">     </span>PID<span class="w">    </span>IP<span class="w"> </span>LADDR:LPORT<span class="w">          </span>T&gt;<span class="w"> </span>RADDR:RPORT<span class="w">          </span>STATE
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="m">01</span>:55:05<span class="w"> </span><span class="m">0</span><span class="w">      </span><span class="m">4</span><span class="w">  </span><span class="m">10</span>.153.223.157:22<span class="w">    </span>R&gt;<span class="w"> </span><span class="m">69</span>.53.245.40:34619<span class="w">   </span>ESTABLISHED
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="m">01</span>:55:05<span class="w"> </span><span class="m">0</span><span class="w">      </span><span class="m">4</span><span class="w">  </span><span class="m">10</span>.153.223.157:22<span class="w">    </span>R&gt;<span class="w"> </span><span class="m">69</span>.53.245.40:34619<span class="w">   </span>ESTABLISHED
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="m">01</span>:55:17<span class="w"> </span><span class="m">0</span><span class="w">      </span><span class="m">4</span><span class="w">  </span><span class="m">10</span>.153.223.157:22<span class="w">    </span>R&gt;<span class="w"> </span><span class="m">69</span>.53.245.40:22957<span class="w">   </span>ESTABLISHED
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="o">[</span>...<span class="o">]</span>
</code></pre></div>
<p>tcprerans prints one line of output for every TCP retransmit packet, with details including source and destination addresses, and kernel state of the TCP connection.</p>
<p>TCP retransmissions cause latency and throughput issues. For ESTABLISHED retransmits, look for patterns with networks. For SYN_SENT, this may point to target kernel CPU saturation and kernel packet drops.</p>
<p>More <a href="https://github.com/iovisor/bcc/tree/master/tools/tcpretrans_example.txt">examples</a>.</p>
<h4 id="110-runqlat">1.10. runqlat</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># ./runqlat</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>Tracing<span class="w"> </span>run<span class="w"> </span>queue<span class="w"> </span>latency...<span class="w"> </span>Hit<span class="w"> </span>Ctrl-C<span class="w"> </span>to<span class="w"> </span>end.
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>^C
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">     </span>usecs<span class="w">               </span>:<span class="w"> </span>count<span class="w">     </span>distribution
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">         </span><span class="m">0</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">1</span><span class="w">          </span>:<span class="w"> </span><span class="m">233</span><span class="w">      </span><span class="p">|</span>***********<span class="w">                             </span><span class="p">|</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">         </span><span class="m">2</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">3</span><span class="w">          </span>:<span class="w"> </span><span class="m">742</span><span class="w">      </span><span class="p">|</span>************************************<span class="w">    </span><span class="p">|</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">         </span><span class="m">4</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">7</span><span class="w">          </span>:<span class="w"> </span><span class="m">203</span><span class="w">      </span><span class="p">|</span>**********<span class="w">                              </span><span class="p">|</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">         </span><span class="m">8</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">15</span><span class="w">         </span>:<span class="w"> </span><span class="m">173</span><span class="w">      </span><span class="p">|</span>********<span class="w">                                </span><span class="p">|</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">        </span><span class="m">16</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">31</span><span class="w">         </span>:<span class="w"> </span><span class="m">24</span><span class="w">       </span><span class="p">|</span>*<span class="w">                                       </span><span class="p">|</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">        </span><span class="m">32</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">63</span><span class="w">         </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                        </span><span class="p">|</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">        </span><span class="m">64</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">127</span><span class="w">        </span>:<span class="w"> </span><span class="m">30</span><span class="w">       </span><span class="p">|</span>*<span class="w">                                       </span><span class="p">|</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">       </span><span class="m">128</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">255</span><span class="w">        </span>:<span class="w"> </span><span class="m">6</span><span class="w">        </span><span class="p">|</span><span class="w">                                        </span><span class="p">|</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">       </span><span class="m">256</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">511</span><span class="w">        </span>:<span class="w"> </span><span class="m">3</span><span class="w">        </span><span class="p">|</span><span class="w">                                        </span><span class="p">|</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">       </span><span class="m">512</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">1023</span><span class="w">       </span>:<span class="w"> </span><span class="m">5</span><span class="w">        </span><span class="p">|</span><span class="w">                                        </span><span class="p">|</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">      </span><span class="m">1024</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">2047</span><span class="w">       </span>:<span class="w"> </span><span class="m">27</span><span class="w">       </span><span class="p">|</span>*<span class="w">                                       </span><span class="p">|</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w">      </span><span class="m">2048</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">4095</span><span class="w">       </span>:<span class="w"> </span><span class="m">30</span><span class="w">       </span><span class="p">|</span>*<span class="w">                                       </span><span class="p">|</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">      </span><span class="m">4096</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">8191</span><span class="w">       </span>:<span class="w"> </span><span class="m">20</span><span class="w">       </span><span class="p">|</span><span class="w">                                        </span><span class="p">|</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">      </span><span class="m">8192</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">16383</span><span class="w">      </span>:<span class="w"> </span><span class="m">29</span><span class="w">       </span><span class="p">|</span>*<span class="w">                                       </span><span class="p">|</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="w">     </span><span class="m">16384</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">32767</span><span class="w">      </span>:<span class="w"> </span><span class="m">809</span><span class="w">      </span><span class="p">|</span>****************************************<span class="p">|</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="w">     </span><span class="m">32768</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">65535</span><span class="w">      </span>:<span class="w"> </span><span class="m">64</span><span class="w">       </span><span class="p">|</span>***<span class="w">                                     </span><span class="p">|</span>
</code></pre></div>
<p>runqlat times how long threads were waiting on the CPU run queues, and prints this as a histogram.</p>
<p>This can help quantify time lost waiting for a turn on CPU, during periods of CPU saturation.</p>
<p>More <a href="https://github.com/iovisor/bcc/tree/master/tools/runqlat_example.txt">examples</a>.</p>
<h4 id="111-profile">1.11. profile</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># ./profile</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>Sampling<span class="w"> </span>at<span class="w"> </span><span class="m">49</span><span class="w"> </span>Hertz<span class="w"> </span>of<span class="w"> </span>all<span class="w"> </span>threads<span class="w"> </span>by<span class="w"> </span>user<span class="w"> </span>+<span class="w"> </span>kernel<span class="w"> </span>stack...<span class="w"> </span>Hit<span class="w"> </span>Ctrl-C<span class="w"> </span>to<span class="w"> </span>end.
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>^C
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">    </span>00007f31d76c3251<span class="w"> </span><span class="o">[</span>unknown<span class="o">]</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">    </span>47a2c1e752bf47f7<span class="w"> </span><span class="o">[</span>unknown<span class="o">]</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">    </span>-<span class="w">                </span>sign-file<span class="w"> </span><span class="o">(</span><span class="m">8877</span><span class="o">)</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">        </span><span class="m">1</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">    </span>ffffffff813d0af8<span class="w"> </span>__clear_user
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">    </span>ffffffff813d5277<span class="w"> </span>iov_iter_zero
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">    </span>ffffffff814ec5f2<span class="w"> </span>read_iter_zero
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">    </span>ffffffff8120be9d<span class="w"> </span>__vfs_read
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">    </span>ffffffff8120c385<span class="w"> </span>vfs_read
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">    </span>ffffffff8120d786<span class="w"> </span>sys_read
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="w">    </span>ffffffff817cc076<span class="w"> </span>entry_SYSCALL_64_fastpath
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="w">    </span>00007fc5652ad9b0<span class="w"> </span><span class="nb">read</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="w">    </span>-<span class="w">                </span>dd<span class="w"> </span><span class="o">(</span><span class="m">25036</span><span class="o">)</span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="w">        </span><span class="m">4</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="w">    </span><span class="m">0000000000400542</span><span class="w"> </span>func_a
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="w">    </span><span class="m">0000000000400598</span><span class="w"> </span>main
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a><span class="w">    </span>00007f12a133e830<span class="w"> </span>__libc_start_main
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a><span class="w">    </span>083e258d4c544155<span class="w"> </span><span class="o">[</span>unknown<span class="o">]</span>
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a><span class="w">    </span>-<span class="w">                </span>func_ab<span class="w"> </span><span class="o">(</span><span class="m">13549</span><span class="o">)</span>
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a><span class="w">        </span><span class="m">5</span>
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a><span class="o">[</span>...<span class="o">]</span>
<a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>
<a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a><span class="w">    </span>ffffffff8105eb66<span class="w"> </span>native_safe_halt
<a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a><span class="w">    </span>ffffffff8103659e<span class="w"> </span>default_idle
<a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a><span class="w">    </span>ffffffff81036d1f<span class="w"> </span>arch_cpu_idle
<a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a><span class="w">    </span>ffffffff810bba5a<span class="w"> </span>default_idle_call
<a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a><span class="w">    </span>ffffffff810bbd07<span class="w"> </span>cpu_startup_entry
<a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a><span class="w">    </span>ffffffff8104df55<span class="w"> </span>start_secondary
<a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a><span class="w">    </span>-<span class="w">                </span>swapper/1<span class="w"> </span><span class="o">(</span><span class="m">0</span><span class="o">)</span>
<a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a><span class="w">        </span><span class="m">75</span>
</code></pre></div>
<p>profile is a CPU profiler, which takes samples of stack traces at timed intervals, and prints a summary of unique stack traces and a count of their occurrence.</p>
<p>Use this tool to understand the code paths that are consuming CPU resources.</p>
<p>More <a href="https://github.com/iovisor/bcc/tree/master/tools/profile_example.txt">examples</a>.</p>
<h3 id="2-observability-with-generic-tools">2. Observability with Generic Tools</h3>
<p>In addition to the above tools for performance tuning, below is a checklist for bcc generic tools, first as a list, and in detail:</p>
<ol>
<li>trace</li>
<li>argdist</li>
<li>funccount</li>
</ol>
<p>These generic tools may be useful to provide visibility to solve your specific problems.</p>
<h4 id="21-trace">2.1. trace</h4>
<h5 id="example-1">Example 1</h5>
<p>Suppose you want to track file ownership change. There are three syscalls, <code>chown</code>, <code>fchown</code> and <code>lchown</code> which users can use to change file ownership. The corresponding syscall entry is <code>SyS_[f|l]chown</code>.  The following command can be used to print out syscall parameters and the calling process user id. You can use <code>id</code> command to find the uid of a particular user.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>$<span class="w"> </span>trace.py<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">  </span><span class="s1">&#39;p::SyS_chown &quot;file = %s, to_uid = %d, to_gid = %d, from_uid = %d&quot;, arg1, arg2, arg3, $uid&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">  </span><span class="s1">&#39;p::SyS_fchown &quot;fd = %d, to_uid = %d, to_gid = %d, from_uid = %d&quot;, arg1, arg2, arg3, $uid&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">  </span><span class="s1">&#39;p::SyS_lchown &quot;file = %s, to_uid = %d, to_gid = %d, from_uid = %d&quot;, arg1, arg2, arg3, $uid&#39;</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>PID<span class="w">    </span>TID<span class="w">    </span>COMM<span class="w">         </span>FUNC<span class="w">             </span>-
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="m">1269255</span><span class="w"> </span><span class="m">1269255</span><span class="w"> </span>python3.6<span class="w">    </span>SyS_lchown<span class="w">       </span><span class="nv">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/tmp/dotsync-usisgezu/tmp,<span class="w"> </span><span class="nv">to_uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">128203</span>,<span class="w"> </span><span class="nv">to_gid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>,<span class="w"> </span><span class="nv">from_uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">128203</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="m">1269441</span><span class="w"> </span><span class="m">1269441</span><span class="w"> </span>zstd<span class="w">         </span>SyS_chown<span class="w">        </span><span class="nv">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/tmp/dotsync-vic7ygj0/dotsync-package.zst,<span class="w"> </span><span class="nv">to_uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">128203</span>,<span class="w"> </span><span class="nv">to_gid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>,<span class="w"> </span><span class="nv">from_uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">128203</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="m">1269255</span><span class="w"> </span><span class="m">1269255</span><span class="w"> </span>python3.6<span class="w">    </span>SyS_lchown<span class="w">       </span><span class="nv">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/tmp/dotsync-a40zd7ev/tmp,<span class="w"> </span><span class="nv">to_uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">128203</span>,<span class="w"> </span><span class="nv">to_gid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>,<span class="w"> </span><span class="nv">from_uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">128203</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="m">1269442</span><span class="w"> </span><span class="m">1269442</span><span class="w"> </span>zstd<span class="w">         </span>SyS_chown<span class="w">        </span><span class="nv">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/tmp/dotsync-gzp413o_/dotsync-package.zst,<span class="w"> </span><span class="nv">to_uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">128203</span>,<span class="w"> </span><span class="nv">to_gid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>,<span class="w"> </span><span class="nv">from_uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">128203</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="m">1269255</span><span class="w"> </span><span class="m">1269255</span><span class="w"> </span>python3.6<span class="w">    </span>SyS_lchown<span class="w">       </span><span class="nv">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/tmp/dotsync-whx4fivm/tmp/.bash_profile,<span class="w"> </span><span class="nv">to_uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">128203</span>,<span class="w"> </span><span class="nv">to_gid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>,<span class="w"> </span><span class="nv">from_uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">128203</span>
</code></pre></div>
<h5 id="example-2">Example 2</h5>
<p>Suppose you want to count nonvoluntary context switches (<code>nvcsw</code>) in your bpf based performance monitoring tools and you do not know what is the proper method. <code>/proc/&lt;pid&gt;/status</code> already tells you the number (<code>nonvoluntary_ctxt_switches</code>) for a pid and you can use <code>trace.py</code> to do a quick experiment to verify your method. With kernel source code, the <code>nvcsw</code> is counted at file <code>linux/kernel/sched/core.c</code> function <code>__schedule</code> and under condition
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="o">!</span><span class="p">(</span><span class="o">!</span><span class="n">preempt</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">prev</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="c1">// i.e., preempt || !prev-&gt;state</span>
</code></pre></div></p>
<p>The <code>__schedule</code> function is marked as <code>notrace</code>, and the best place to evaluate the above condition seems in <code>sched/sched_switch</code> tracepoint called inside function <code>__schedule</code> and defined in <code>linux/include/trace/events/sched.h</code>. <code>trace.py</code> already has <code>args</code> being the pointer to the tracepoint <code>TP_STRUCT__entry</code>.  The above condition in function <code>__schedule</code> can be represented as
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">args</span><span class="o">-&gt;</span><span class="n">prev_state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">TASK_STATE_MAX</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">args</span><span class="o">-&gt;</span><span class="n">prev_state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>
</code></pre></div></p>
<p>The below command can be used to count the involuntary context switches (per process or per pid) and compare to <code>/proc/&lt;pid&gt;/status</code> or <code>/proc/&lt;pid&gt;/task/&lt;task_id&gt;/status</code> for correctness, as in typical cases, involuntary context switches are not very common.
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>$<span class="w"> </span>trace.py<span class="w"> </span>-p<span class="w"> </span><span class="m">1134138</span><span class="w"> </span><span class="s1">&#39;t:sched:sched_switch (args-&gt;prev_state == TASK_STATE_MAX || args-&gt;prev_state == 0)&#39;</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>PID<span class="w">    </span>TID<span class="w">    </span>COMM<span class="w">         </span>FUNC
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="m">1134138</span><span class="w"> </span><span class="m">1134140</span><span class="w"> </span>contention_test<span class="w"> </span>sched_switch
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="m">1134138</span><span class="w"> </span><span class="m">1134142</span><span class="w"> </span>contention_test<span class="w"> </span>sched_switch
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>...
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>$<span class="w"> </span>trace.py<span class="w"> </span>-L<span class="w"> </span><span class="m">1134140</span><span class="w"> </span><span class="s1">&#39;t:sched:sched_switch (args-&gt;prev_state == TASK_STATE_MAX || args-&gt;prev_state == 0)&#39;</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>PID<span class="w">    </span>TID<span class="w">    </span>COMM<span class="w">         </span>FUNC
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="m">1134138</span><span class="w"> </span><span class="m">1134140</span><span class="w"> </span>contention_test<span class="w"> </span>sched_switch
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="m">1134138</span><span class="w"> </span><span class="m">1134140</span><span class="w"> </span>contention_test<span class="w"> </span>sched_switch
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>...
</code></pre></div></p>
<h5 id="example-3">Example 3</h5>
<p>This example is related to issue <a href="https://github.com/iovisor/bcc/issues/1231">1231</a> and <a href="https://github.com/iovisor/bcc/issues/1516">1516</a> where uprobe does not work at all in certain cases. First, you can do a <code>strace</code> as below</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>$<span class="w"> </span>strace<span class="w"> </span>trace.py<span class="w"> </span><span class="s1">&#39;r:bash:readline &quot;%s&quot;, retval&#39;</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>...
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>perf_event_open<span class="o">(</span>0x7ffd968212f0,<span class="w"> </span>-1,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>-1,<span class="w"> </span>0x8<span class="w"> </span>/*<span class="w"> </span>PERF_FLAG_???<span class="w"> </span>*/<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>-1<span class="w"> </span>EIO<span class="w"> </span><span class="o">(</span>Input/output<span class="w"> </span>error<span class="o">)</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>...
</code></pre></div>
<p>The <code>perf_event_open</code> syscall returns <code>-EIO</code>. Digging into kernel uprobe related codes in <code>/kernel/trace</code> and <code>/kernel/events</code> directories to search <code>EIO</code>, the function <code>uprobe_register</code> is the most suspicious. Let us find whether this function is called or not and what is the return value if it is called. In one terminal using the following command to print out the return value of uprobe_register,
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>$<span class="w"> </span>trace.py<span class="w"> </span><span class="s1">&#39;r::uprobe_register &quot;ret = %d&quot;, retval&#39;</span>
</code></pre></div>
In another terminal run the same bash uretprobe tracing example, and you should get
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>$<span class="w"> </span>trace.py<span class="w"> </span><span class="s1">&#39;r::uprobe_register &quot;ret = %d&quot;, retval&#39;</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>PID<span class="w">    </span>TID<span class="w">    </span>COMM<span class="w">         </span>FUNC<span class="w">             </span>-
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="m">1041401</span><span class="w"> </span><span class="m">1041401</span><span class="w"> </span>python2.7<span class="w">    </span>uprobe_register<span class="w">  </span><span class="nv">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>-5
</code></pre></div></p>
<p>The <code>-5</code> error code is EIO. This confirms that the following code in function <code>uprobe_register</code> is the most suspicious culprit.
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">inode</span><span class="o">-&gt;</span><span class="n">i_mapping</span><span class="o">-&gt;</span><span class="n">a_ops</span><span class="o">-&gt;</span><span class="n">readpage</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">shmem_mapping</span><span class="p">(</span><span class="n">inode</span><span class="o">-&gt;</span><span class="n">i_mapping</span><span class="p">))</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
</code></pre></div>
The <code>shmem_mapping</code> function is defined as
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">shmem_mapping</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">address_space</span><span class="w"> </span><span class="o">*</span><span class="n">mapping</span><span class="p">)</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="p">{</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mapping</span><span class="o">-&gt;</span><span class="n">a_ops</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">&amp;</span><span class="n">shmem_aops</span><span class="p">;</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="p">}</span>
</code></pre></div></p>
<p>To confirm the theory, find what is <code>inode-&gt;i_mapping-&gt;a_ops</code> with the following command
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>$<span class="w"> </span>trace.py<span class="w"> </span>-I<span class="w"> </span><span class="s1">&#39;linux/fs.h&#39;</span><span class="w"> </span><span class="s1">&#39;p::uprobe_register(struct inode *inode) &quot;a_ops = %llx&quot;, inode-&gt;i_mapping-&gt;a_ops&#39;</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>PID<span class="w">    </span>TID<span class="w">    </span>COMM<span class="w">         </span>FUNC<span class="w">             </span>-
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="m">814288</span><span class="w"> </span><span class="m">814288</span><span class="w"> </span>python2.7<span class="w">    </span>uprobe_register<span class="w">  </span><span class="nv">a_ops</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>ffffffff81a2adc0
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>^C$<span class="w"> </span>grep<span class="w"> </span>ffffffff81a2adc0<span class="w"> </span>/proc/kallsyms
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>ffffffff81a2adc0<span class="w"> </span>R<span class="w"> </span>empty_aops
</code></pre></div></p>
<p>The kernel symbol <code>empty_aops</code> does not have <code>readpage</code> defined and hence the above suspicious condition is true. Further examining the kernel source code shows that <code>overlayfs</code> does not provide its own <code>a_ops</code> while some other file systems (e.g., ext4) define their own <code>a_ops</code> (e.g., <code>ext4_da_aops</code>), and <code>ext4_da_aops</code> defines <code>readpage</code>. Hence, uprobe works fine on ext4 while not on overlayfs.</p>
<p>More <a href="https://github.com/iovisor/bcc/tree/master/tools/trace_example.txt">examples</a>.</p>
<h4 id="22-argdist">2.2. argdist</h4>
<p>More <a href="https://github.com/iovisor/bcc/tree/master/tools/argdist_example.txt">examples</a>.</p>
<h4 id="23-funccount">2.3. funccount</h4>
<p>More <a href="https://github.com/iovisor/bcc/tree/master/tools/funccount_example.txt">examples</a>.</p>
<h2 id="networking">Networking</h2>
<p>To do.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright (c) 2023 eunomia-bpf org.
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/eunomia-bpf" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.indexes", "navigation.expand", "navigation.sections", "header.autohide"], "search": "../../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
<script src="https://cdn.usefathom.com/script.js" data-site="ZLDAHRNN" defer></script>

      <script src="../../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    

  </body>
</html>